!function($){$(function(){function o(o){var l="";return l+='<div class="soliloquy-video-slide-holder"><p class="no-margin-top"><a href="#" class="button button-secondary soliloquy-delete-video-slide" title="'+soliloquy_metabox.removeslide+'">'+soliloquy_metabox.removeslide+'</a><label for="soliloquy-video-slide-'+o+'-title"><strong>'+soliloquy_metabox.videoslide+'</strong></label><br /><input type="text" class="soliloquy-video-slide-title" id="soliloquy-video-slide-'+o+'-title" value="" placeholder="'+soliloquy_metabox.videoplace+'" /></p><p><label for="soliloquy-video-slide-'+o+'"><strong>'+soliloquy_metabox.videotitle+'</strong></label><br /><input type="text" class="soliloquy-video-slide-url" id="soliloquy-video-slide-'+o+'" value="" placeholder="'+soliloquy_metabox.videooutput+'" /></p><p><label for="soliloquy-video-slide-'+o+'-thumbnail"><strong>'+soliloquy_metabox.videothumb+'</strong></label><br /><input type="text" class="soliloquy-video-slide-thumbnail" id="soliloquy-video-slide-'+o+'-thumbnail" value="" placeholder="'+soliloquy_metabox.videosrc+'" /> <span><a href="#" class="soliloquy-video-thumbnail button button-primary">'+soliloquy_metabox.videoselect+'</a> <a href="#" class="soliloquy-video-thumbnail-delete button button-secondary">'+soliloquy_metabox.videodelete+'</a></span></p><p class="no-margin-bottom"><label for="soliloquy-video-slide-'+o+'-caption"><strong>'+soliloquy_metabox.videocaption+'</strong></label><br /><textarea class="soliloquy-video-slide-caption" id="soliloquy-video-slide-'+o+'-caption"></textarea></p></div>'}function l(o){var l="";return l+='<div class="soliloquy-html-slide-holder"><p class="no-margin-top"><a href="#" class="button button-secondary soliloquy-delete-html-slide" title="'+soliloquy_metabox.removeslide+'">'+soliloquy_metabox.removeslide+'</a><label for="soliloquy-html-slide-'+o+'-title"><strong>'+soliloquy_metabox.htmlslide+'</strong></label><br /><input type="text" class="soliloquy-html-slide-title" id="soliloquy-html-slide-'+o+'-title" value="" placeholder="'+soliloquy_metabox.htmlplace+'" /></p><p class="no-margin-bottom"><label for="soliloquy-html-slide-'+o+'"><strong>'+soliloquy_metabox.htmlcode+'</strong></label><br /><textarea class="soliloquy-html-slide-code" id="soliloquy-html-slide-'+o+'">'+soliloquy_metabox.htmlstart+'</textarea><p><label for="soliloquy-html-slide-'+o+'-thumbnail"><strong>'+soliloquy_metabox.htmlthumb+'</strong></label><br /><input type="text" class="soliloquy-html-slide-thumbnail" id="soliloquy-html-slide-'+o+'-thumbnail" value="" placeholder="'+soliloquy_metabox.htmlsrc+'" /> <span><a href="#" class="soliloquy-html-thumbnail button button-primary">'+soliloquy_metabox.htmlselect+'</a> <a href="#" class="soliloquy-html-thumbnail-delete button button-secondary">'+soliloquy_metabox.htmldelete+"</a></span></p></div>"}function e(){var o={action:"soliloquy_refresh",post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.refresh_nonce};$(".max-upload-size").after('<span class="spinner soliloquy-spinner soliloquy-spinner-refresh"></span>'),$(".soliloquy-spinner-refresh").css({display:"inline-block","margin-top":"-3px"}),$.post(soliloquy_metabox.ajax,o,function(o){o&&o.success&&($("#soliloquy-output").html(o.success),$("#soliloquy-output").find(".wp-editor-wrap").each(function(o,l){var e=$(l).find(".quicktags-toolbar");if(!(e.length>0)){var i=$(l).attr("id").split("-"),t=i.slice(3,-1).join("-");quicktags({id:"soliloquy-caption-"+t,buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()}}),$(".soliloquy-html").find(".soliloquy-html-code").each(function(o,l){var e=$(l).attr("id");p[e]=CodeMirror.fromTextArea(l,{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),p[e].on("blur",function(o){$("#"+e).text(o.getValue())}),p[e].refresh()}),$("#soliloquy-output").trigger({type:"soliloquyRefreshed",html:o.success,id:soliloquy_metabox.id})),$(".soliloquy-spinner-refresh").fadeOut(300,function(){$(this).remove()})},"json")}function i(){var o=$("#soliloquy-config-mobile");o.is(":checked")&&$("#soliloquy-config-mobile-size-box").fadeIn(300),o.on("change",function(){$(this).is(":checked")?$("#soliloquy-config-mobile-size-box").fadeIn(300):$("#soliloquy-config-mobile-size-box").fadeOut(300)})}function t(){$("#soliloquy .drag-drop-inside").append('<div class="soliloquy-progress-bar"><div></div></div>'),c=new plupload.Uploader(soliloquy_metabox.plupload);var o=$("#soliloquy .soliloquy-progress-bar"),l=$("#soliloquy .soliloquy-progress-bar div"),e=$("#soliloquy-output");c&&(c.bind("Init",function(o){var l=$("#soliloquy-plupload-upload-ui");o.features.dragdrop&&!$(document.body).hasClass("mobile")?(l.addClass("drag-drop"),$("#soliloquy-drag-drop-area").bind("dragover.wp-uploader",function(){l.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){l.removeClass("drag-over")})):(l.removeClass("drag-drop"),$("#soliloquy-drag-drop-area").unbind(".wp-uploader")),"html4"==o.runtime&&$(".upload-flash-bypass").hide()}),c.init(),c.bind("FilesAdded",function(l,e){var i=104857600,t=parseInt(l.settings.max_file_size,10);$("#soliloquy-upload-error").html(""),$(o).show().css("display","block"),plupload.each(e,function(o){t>i&&o.size>i&&"html5"!=l.runtime&&a(l,o,!0)}),l.refresh(),l.start()}),c.bind("UploadProgress",function(o,e){$(l).css("width",o.total.percent+"%")}),c.bind("FileUploaded",function(o,l,i){$.post(soliloquy_metabox.ajax,{action:"soliloquy_load_image",nonce:soliloquy_metabox.load_image,id:i.response,post_id:soliloquy_metabox.id},function(o){$(e).append(o),$(o).find(".wp-editor-container").each(function(o,l){var e=$(l).attr("id").split("-")[3];quicktags({id:"soliloquy-caption-"+e,buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()})},"json")}),c.bind("UploadComplete",function(){$(o).hide().css("display","none"),$(l).removeAttr("style")}),c.bind("Error",function(o,l){var e=104857600,i=$("#soliloquy-upload-error"),t;switch(l){case plupload.FAILED:case plupload.FILE_EXTENSION_ERROR:i.html('<p class="error">'+pluploadL10n.upload_failed+"</p>");break;case plupload.FILE_SIZE_ERROR:a(o,l.file);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(fileObj,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(fileObj,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(fileObj,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:t=parseInt(uploader.settings.max_file_size,10),t>e&&fileObj.size>e?wpFileError(fileObj,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:$(".media-upload-form").addClass("html-uploader");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:a(o,l.file)}o.refresh()}))}function a(o,l,e){var i;i=e?pluploadL10n.big_upload_queued.replace("%s",l.name)+" "+pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>"):pluploadL10n.file_exceeds_size_limit.replace("%s",l.name),$("#soliloquy-upload-error").html('<div class="error fade"><p>'+i+"</p></div>"),o.removeFile(l)}var s=$("#soliloquy-tabs"),n=$("#soliloquy-tabs-nav"),r=window.location.hash,u=window.location.hash.replace("!","");if(r&&r.indexOf("soliloquy-tab-")>=0){$(".soliloquy-active").removeClass("soliloquy-active"),n.find('li a[href="'+u+'"]').parent().addClass("soliloquy-active"),s.find(u).addClass("soliloquy-active").show();var d=$("#post").attr("action");d&&(d=d.split("#")[0],$("#post").attr("action",d+r))}$(document).on("click","#soliloquy-tabs-nav li a",function(o){o.preventDefault();var l=$(this);if(!l.parent().hasClass("soliloquy-active")){window.location.hash=r=this.hash.split("#").join("#!");var e=n.find(".soliloquy-active").removeClass("soliloquy-active").find("a").attr("href");l.parent().addClass("soliloquy-active"),s.find(e).removeClass("soliloquy-active").hide(),s.find(l.attr("href")).addClass("soliloquy-active").show();var i=$("#post").attr("action");i&&(i=i.split("#")[0],$("#post").attr("action",i+r))}});var c;$('input[name="_soliloquy[type]"]').length>0&&"default"==$('input[name="_soliloquy[type]"]:checked').val()&&t(),i(),0!==$(".soliloquy-helper-needed").length&&$('<div class="soliloquy-meta-helper-overlay" />').prependTo("#soliloquy"),$(document).on("click",".soliloquy-meta-icon",function(o){o.preventDefault();var l=$(this),e=l.parent(),i=l.next();i.is(":visible")?($(".soliloquy-meta-helper-overlay").remove(),e.removeClass("soliloquy-helper-active")):(0===$(".soliloquy-meta-helper-overlay").length&&$('<div class="soliloquy-meta-helper-overlay" />').prependTo("#soliloquy"),e.addClass("soliloquy-helper-active"))}),$(document).on("change",'input[name="_soliloquy[type]"]:radio',function(o){var l=$(this);$(".soliloquy-type-spinner .soliloquy-spinner").css({display:"inline-block","margin-top":"-1px"});var e={action:"soliloquy_change_type",post_id:soliloquy_metabox.id,type:l.val(),nonce:soliloquy_metabox.change_nonce};$.post(soliloquy_metabox.ajax,e,function(o){"default"==o.type?($("#soliloquy-slider-main").html(o.html),t()):$("#soliloquy-slider-main").html(o.html),$(document).trigger("soliloquySliderType",o),$(".soliloquy-type-spinner .soliloquy-spinner").hide()},"json")}),$(document).on("click",".soliloquy-media-library",function(o){o.preventDefault(),q=!0,$("#soliloquy-upload-ui").appendTo("body").show()}),$(".soliloquy-slider").on("click",".thumbnail, .check, .media-modal-icon",function(o){o.preventDefault(),$(this).parent().parent().hasClass("soliloquy-in-slider")||($(this).parent().parent().hasClass("selected")?$(this).parent().parent().removeClass("details selected"):$(this).parent().parent().addClass("details selected"))}),$(document).on("click",".soliloquy-load-library",function(o){o.preventDefault();var l=$(this);l.next().css({display:"inline-block","margin-top":"14px","margin-left":"-5px"});var e={action:"soliloquy_load_library",offset:parseInt(l.attr("data-soliloquy-offset")),post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.load_slider};$.post(soliloquy_metabox.ajax,e,function(o){l.attr("data-soliloquy-offset",parseInt(l.attr("data-soliloquy-offset"))+20),o&&o.html&&l.hasClass("has-search")?($(".soliloquy-slider").html(o.html),l.removeClass("has-search")):$(".soliloquy-slider").append(o.html),l.next().hide()},"json")}),$(document).on("keyup keydown","#soliloquy-slider-search",function(){var o=$(this);o.prev().css({display:"inline-block","margin-top":"1px","vertical-align":"middle","margin-right":"4px"});var l=$(this).val(),e={action:"soliloquy_library_search",nonce:soliloquy_metabox.library_search,post_id:soliloquy_metabox.id,search:l};h(function(){$.post(soliloquy_metabox.ajax,e,function(l){$(".soliloquy-load-library").addClass("has-search").attr("data-soliloquy-offset",parseInt(0)),l&&$(".soliloquy-slider").html(l.html),o.prev().hide()},"json")},"500")}),$(document).on("click",".soliloquy-media-insert",function(o){o.preventDefault();var l=$(this),e=l.text(),i={action:"soliloquy_insert_slides",nonce:soliloquy_metabox.insert_nonce,post_id:soliloquy_metabox.id,images:{},videos:{},html:{}},t=!1,a=!1,s=!1,n=o;l.text(soliloquy_metabox.inserting),$(".soliloquy-media-frame").find(".attachment.selected:not(.soliloquy-in-slider)").each(function(o,l){i.images[o]=$(l).attr("data-attachment-id"),t=!0}),$(".soliloquy-media-frame").find(".soliloquy-video-slide-holder").each(function(o,l){i.videos[o]={title:$(l).find(".soliloquy-video-slide-title").val(),url:$(l).find(".soliloquy-video-slide-url").val(),thumb:$(l).find(".soliloquy-video-slide-thumbnail").val(),caption:$(l).find(".soliloquy-video-slide-caption").val()},a=!0}),$(".soliloquy-media-frame").find(".soliloquy-html-slide-holder").each(function(o,l){i.html[o]={title:$(l).find(".soliloquy-html-slide-title").val(),code:$(l).find(".soliloquy-html-slide-code").val(),thumb:$(l).find(".soliloquy-html-slide-thumbnail").val()},s=!0}),$.post(soliloquy_metabox.ajax,i,function(o){setTimeout(function(){f(n),l.text(e),t&&$(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click")},500)},"json")}),$(document).on("click",".soliloquy-media-frame .media-menu-item",function(o){o.preventDefault();var l=$(this),e=l.parent().find(".active").removeClass("active").data("soliloquy-content"),i=l.addClass("active").data("soliloquy-content");$("#soliloquy-"+e).hide(),$("#soliloquy-"+i).show()}),$(document).on("click",".soliloquy-add-video-slide",function(l){l.preventDefault();var e=parseInt($(this).attr("data-soliloquy-video-number")),i="soliloquy-video-slide-"+$(this).attr("data-soliloquy-html-number");$(this).attr("data-soliloquy-video-number",e+1).parent().before(o(e))}),$(document).on("click",".soliloquy-video-thumbnail",function(o){o.preventDefault();var l=wp.media.frames.soliloquy_media_frame=wp.media({className:"media-frame soliloquy-media-frame",frame:"select",multiple:!1,title:soliloquy_metabox.videoframe,library:{type:"image"},button:{text:soliloquy_metabox.videouse}}),e=$(this);l.on("select",function(){var o=l.state().get("selection").first().toJSON();e.parent().prev().val(o.url)}),l.open()}),$(document).on("click",".soliloquy-video-thumbnail-delete",function(o){o.preventDefault(),$(this).parent().prev().val("")}),$(document).on("click","#soliloquy-video-slides .soliloquy-delete-video-slide",function(o){o.preventDefault(),$(this).parent().parent().remove()});var p={};$(".soliloquy-html").find(".soliloquy-html-code").each(function(o,l){var e=$(l).attr("id");p[e]=CodeMirror.fromTextArea(l,{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),p[e].on("blur",function(o){$("#"+e).text(o.getValue())}),p[e].refresh()}),$(document).on("click",".soliloquy-add-html-slide",function(o){o.preventDefault();var e=parseInt($(this).attr("data-soliloquy-html-number")),i="soliloquy-html-slide-"+$(this).attr("data-soliloquy-html-number");$(this).attr("data-soliloquy-html-number",e+1).parent().before(l(e)),p[i]=CodeMirror.fromTextArea(document.getElementById(i),{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),p[i].on("blur",function(o){$("#"+i).text(o.getValue())}),p[i].refresh()}),$(document).on("click",".soliloquy-html-thumbnail",function(o){o.preventDefault();var l=wp.media.frames.soliloquy_media_frame=wp.media({className:"media-frame soliloquy-media-frame",frame:"select",multiple:!1,title:soliloquy_metabox.htmlframe,library:{type:"image"},button:{text:soliloquy_metabox.htmluse}}),e=$(this);l.on("select",function(){var o=l.state().get("selection").first().toJSON();e.parent().prev().val(o.url)}),l.open()}),$(document).on("click","#soliloquy-html-slides .soliloquy-delete-html-slide",function(o){o.preventDefault(),$(this).parent().parent().remove()}),$(document).on("click",".soliloquy-html-thumbnail-delete",function(o){o.preventDefault(),$(this).parent().prev().val("")});var m=$("#soliloquy-output");m.sortable({containment:"#soliloquy",items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",update:function(o,l){var e={url:soliloquy_metabox.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_sort_images",order:m.sortable("toArray").toString(),post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.sort},success:function(o){},error:function(o,l,e){}};$.ajax(e)}}),$(document).on("click","#soliloquy .soliloquy-remove-slide",function(o){o.preventDefault();var l=confirm(soliloquy_metabox.remove);if(l){var e=$(this).parent().attr("id"),i={action:"soliloquy_remove_slide",attachment_id:e,post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.remove_nonce};$.post(soliloquy_metabox.ajax,i,function(o){$("#"+e).fadeOut("normal",function(){$(this).remove(),$(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click")})},"json")}});var y=!1;$(document).on("click.soliloquyModify","#soliloquy .soliloquy-modify-slide",function(o){o.preventDefault();var l=$(this).parent().data("soliloquy-slide"),e="soliloquy-meta-"+l;y=!0,$("#"+e).appendTo("body").show(),$.each(p,function(){this.refresh()});var i=function(o){o.preventDefault(),$("#"+e).appendTo("#"+l).hide(),y=!1,$(document).off("click.soliloquyLink")};$(document).on("click.soliloquyIframe",".media-modal-close, .media-modal-backdrop",i),$(document).off("keydown.soliloquyIframe").on("keydown.soliloquyIframe",function(o){27==o.keyCode&&y&&i(o)}),$(document).on("click.soliloquyLink",".ed_button",function(){$("#wp-link-backdrop").css("zIndex","170100"),$("#wp-link-wrap").css("zIndex","171005")})}),$(document).on("click",".soliloquy-meta-submit",function(o){o.preventDefault();var l=$(this),e=l.text(),i=l.data("soliloquy-item"),t="soliloquy-meta-"+i,a={};l.text(soliloquy_metabox.saving),a.caption=$("#soliloquy-meta-table-"+i).find('textarea[name="_soliloquy[meta_caption]"]').val(),$("#soliloquy-meta-table-"+i).find(":input,select").not(".ed_button").each(function(o,l){$(this).data("soliloquy-meta")&&(a[$(this).data("soliloquy-meta")]="checkbox"==$(this).attr("type")||"radio"==$(this).attr("type")?$(this).is(":checked")?1:0:"select"==$(this).attr("type")?$(this).find(":selected").val():$(this).val())});var s={action:"soliloquy_save_meta",nonce:soliloquy_metabox.save_nonce,attach_id:i,post_id:soliloquy_metabox.id,meta:a};$.post(soliloquy_metabox.ajax,s,function(o){setTimeout(function(){$("#"+t).appendTo("#"+i).hide(),l.text(e)},500)},"json")}),$(document).on("click","#soliloquy-import-submit",function(o){$(this).next().css("display","inline-block"),0===$("#soliloquy-config-import-slider").val().length&&(o.preventDefault(),$(this).next().hide(),alert(soliloquy_metabox["import"]))});var h=function(){var o=0;return function(l,e){clearTimeout(o),o=setTimeout(l,e)}}(),q=!1,f=function(o){o.preventDefault(),$("#soliloquy-upload-ui").appendTo("#soliloquy-upload-ui-wrapper").hide(),e(),q=!1};$(document).on("click","#soliloquy-upload-ui .media-modal-close, #soliloquy-upload-ui .media-modal-backdrop",f),$(document).on("keydown",function(o){27==o.keyCode&&q&&f(o)})})}(jQuery);